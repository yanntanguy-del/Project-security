{
  "metadata": {
    "name": "CIS Apple macOS 15 Sequoia Benchmark",
    "version": "1.0.0",
    "description": "Baseline de sécurité basé sur CIS Benchmarks pour macOS Sequoia (15.x)",
    "os": "macOS",
    "osVersion": "15",
    "minVersion": "15.0",
    "maxVersion": "15.99",
    "source": "CIS Benchmarks + Apple Security Guidelines",
    "lastUpdated": "2025-01-15"
  },
  "variants": {
    "Apple Silicon": {
      "additionalFindings": [
        {
          "id": "MAC-AS001",
          "category": "Apple Silicon Security",
          "name": "Secure Enclave Status",
          "method": "command",
          "command": "system_profiler SPiBridgeDataType 2>/dev/null | grep -q 'Secure Enclave'",
          "severity": "Info",
          "recommendedValue": "Available",
          "description": "Vérifier la présence du Secure Enclave (Apple Silicon)"
        },
        {
          "id": "MAC-AS002",
          "category": "Apple Silicon Security",
          "name": "Kernel Integrity Protection",
          "method": "command",
          "command": "csrutil authenticated-root status",
          "severity": "High",
          "recommendedValue": "enabled",
          "description": "Protection de l'intégrité du kernel (Signed System Volume)"
        },
        {
          "id": "MAC-AS003",
          "category": "Apple Silicon Security",
          "name": "Pointer Authentication (PAC)",
          "method": "info",
          "severity": "High",
          "defaultValue": "enabled",
          "recommendedValue": "enabled",
          "description": "Protection contre les attaques ROP/JOP activée sur Apple Silicon"
        }
      ]
    }
  },
  "findings": [
    {
      "id": "MAC1001",
      "category": "System Integrity Protection",
      "name": "System Integrity Protection (SIP)",
      "method": "command",
      "command": "csrutil status",
      "severity": "Critical",
      "defaultValue": "enabled",
      "recommendedValue": "enabled",
      "operator": "contains",
      "description": "SIP protège les fichiers et dossiers système contre les modifications",
      "remediation": {
        "default": "Redémarrer en Recovery Mode (Cmd+R), ouvrir Terminal, exécuter: csrutil enable",
        "manual": "Recovery Mode > Terminal > csrutil enable > Redémarrer"
      }
    },
    {
      "id": "MAC1002",
      "category": "System Integrity Protection",
      "name": "Gatekeeper Status",
      "method": "command",
      "command": "spctl --status",
      "severity": "High",
      "defaultValue": "assessments enabled",
      "recommendedValue": "assessments enabled",
      "operator": "contains",
      "description": "Gatekeeper vérifie que les apps téléchargées proviennent de développeurs identifiés",
      "remediation": {
        "default": "sudo spctl --master-enable",
        "gui": "Réglages Système > Confidentialité et Sécurité > Autoriser les applications de: App Store et développeurs identifiés"
      }
    },
    {
      "id": "MAC1003",
      "category": "System Integrity Protection",
      "name": "XProtect Status",
      "method": "command",
      "command": "system_profiler SPInstallHistoryDataType | grep -A 2 'XProtect'",
      "severity": "High",
      "recommendedValue": "installed",
      "description": "XProtect est l'antimalware intégré d'Apple avec mise à jour automatique",
      "remediation": {
        "default": "Installer les mises à jour système via: softwareupdate --install --all"
      }
    },
    {
      "id": "MAC1005",
      "category": "System Integrity Protection",
      "name": "Lockdown Mode Available",
      "method": "command",
      "command": "defaults read /Library/Managed\\ Preferences/.GlobalPreferences LockdownModeEnabled 2>/dev/null || echo 'not enabled'",
      "severity": "Info",
      "recommendedValue": "available",
      "description": "Mode Isolement (Lockdown Mode) disponible pour protection extrême contre les attaques ciblées",
      "remediation": {
        "gui": "Réglages Système > Confidentialité et Sécurité > Mode Isolement"
      }
    },
    {
      "id": "MAC2001",
      "category": "FileVault",
      "name": "FileVault Disk Encryption",
      "method": "command",
      "command": "fdesetup status",
      "severity": "Critical",
      "defaultValue": "Off",
      "recommendedValue": "On",
      "operator": "contains",
      "description": "FileVault chiffre l'intégralité du disque pour protéger les données",
      "remediation": {
        "default": "sudo fdesetup enable",
        "gui": "Réglages Système > Confidentialité et Sécurité > FileVault > Activer FileVault"
      }
    },
    {
      "id": "MAC2002",
      "category": "FileVault",
      "name": "FileVault Recovery Key",
      "method": "command",
      "command": "sudo fdesetup haspersonalrecoverykey",
      "severity": "High",
      "recommendedValue": "true",
      "description": "Une clé de récupération FileVault doit être configurée",
      "remediation": {
        "default": "Lors de l'activation de FileVault, sauvegarder la clé de récupération"
      }
    },
    {
      "id": "MAC3001",
      "category": "Firewall",
      "name": "Application Firewall Status",
      "method": "command",
      "command": "sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate",
      "severity": "High",
      "defaultValue": "disabled",
      "recommendedValue": "enabled",
      "operator": "contains",
      "description": "Le pare-feu applicatif macOS doit être activé",
      "remediation": {
        "default": "sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on",
        "gui": "Réglages Système > Réseau > Pare-feu > Activer"
      }
    },
    {
      "id": "MAC3002",
      "category": "Firewall",
      "name": "Firewall Stealth Mode",
      "method": "command",
      "command": "sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getstealthmode",
      "severity": "Medium",
      "defaultValue": "disabled",
      "recommendedValue": "enabled",
      "operator": "contains",
      "description": "Le mode furtif empêche la machine de répondre aux requêtes ping",
      "remediation": {
        "default": "sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on",
        "gui": "Réglages Système > Réseau > Pare-feu > Options > Mode furtif"
      }
    },
    {
      "id": "MAC4001",
      "category": "Screen Lock",
      "name": "Require Password After Sleep/Screensaver",
      "method": "defaults",
      "domain": "com.apple.screensaver",
      "key": "askForPassword",
      "severity": "High",
      "defaultValue": "0",
      "recommendedValue": "1",
      "operator": "=",
      "description": "Exiger le mot de passe immédiatement après la mise en veille",
      "remediation": {
        "default": "defaults write com.apple.screensaver askForPassword -int 1",
        "gui": "Réglages Système > Écran de verrouillage > Exiger le mot de passe"
      }
    },
    {
      "id": "MAC4002",
      "category": "Screen Lock",
      "name": "Password Delay After Sleep",
      "method": "defaults",
      "domain": "com.apple.screensaver",
      "key": "askForPasswordDelay",
      "severity": "Medium",
      "defaultValue": "300",
      "recommendedValue": "0",
      "operator": "<=",
      "description": "Délai avant demande de mot de passe (0 = immédiatement)",
      "remediation": {
        "default": "defaults write com.apple.screensaver askForPasswordDelay -int 0"
      }
    },
    {
      "id": "MAC5001",
      "category": "Remote Access",
      "name": "SSH Remote Login",
      "method": "command",
      "command": "sudo systemsetup -getremotelogin",
      "severity": "Medium",
      "defaultValue": "Off",
      "recommendedValue": "Off",
      "operator": "contains",
      "description": "SSH doit être désactivé si non nécessaire",
      "remediation": {
        "default": "sudo systemsetup -setremotelogin off",
        "gui": "Réglages Système > Général > Partage > Connexion à distance"
      }
    },
    {
      "id": "MAC5002",
      "category": "Remote Access",
      "name": "Screen Sharing",
      "method": "command",
      "command": "sudo launchctl list | grep -c screensharing || echo '0'",
      "severity": "Medium",
      "defaultValue": "0",
      "recommendedValue": "0",
      "operator": "=",
      "description": "Le partage d'écran doit être désactivé si non nécessaire",
      "remediation": {
        "default": "sudo launchctl disable system/com.apple.screensharing",
        "gui": "Réglages Système > Général > Partage > Partage d'écran"
      }
    },
    {
      "id": "MAC5005",
      "category": "Remote Access",
      "name": "iPhone Mirroring Control",
      "method": "info",
      "severity": "Low",
      "description": "iPhone Mirroring (nouveau dans Sequoia) - Contrôler les permissions d'accès",
      "remediation": {
        "gui": "Réglages Système > Bureau et Dock > iPhone Mirroring"
      }
    },
    {
      "id": "MAC6001",
      "category": "Privacy",
      "name": "Location Services",
      "method": "command",
      "command": "sudo defaults read /var/db/locationd/Library/Preferences/ByHost/com.apple.locationd.plist LocationServicesEnabled 2>/dev/null || echo 'not set'",
      "severity": "Low",
      "recommendedValue": "0",
      "description": "Services de localisation - à désactiver si non nécessaire",
      "remediation": {
        "gui": "Réglages Système > Confidentialité et Sécurité > Services de localisation"
      }
    },
    {
      "id": "MAC6004",
      "category": "Privacy",
      "name": "App Privacy Report",
      "method": "info",
      "severity": "Info",
      "description": "Rapport de confidentialité des apps montre quelles apps accèdent à vos données",
      "remediation": {
        "gui": "Réglages Système > Confidentialité et Sécurité > Rapport de confidentialité des apps"
      }
    },
    {
      "id": "MAC7001",
      "category": "Software Updates",
      "name": "Automatic Updates Check",
      "method": "defaults",
      "domain": "/Library/Preferences/com.apple.SoftwareUpdate",
      "key": "AutomaticCheckEnabled",
      "severity": "High",
      "defaultValue": "1",
      "recommendedValue": "1",
      "operator": "=",
      "description": "La vérification automatique des mises à jour doit être activée",
      "remediation": {
        "default": "sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true"
      }
    },
    {
      "id": "MAC7004",
      "category": "Software Updates",
      "name": "Install Security Responses",
      "method": "defaults",
      "domain": "/Library/Preferences/com.apple.SoftwareUpdate",
      "key": "CriticalUpdateInstall",
      "severity": "Critical",
      "defaultValue": "1",
      "recommendedValue": "1",
      "operator": "=",
      "description": "Installer automatiquement les Rapid Security Responses",
      "remediation": {
        "default": "sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate CriticalUpdateInstall -bool true"
      }
    },
    {
      "id": "MAC8001",
      "category": "Safari Security",
      "name": "Safari Fraudulent Sites Warning",
      "method": "defaults",
      "domain": "com.apple.Safari",
      "key": "WarnAboutFraudulentWebsites",
      "severity": "Medium",
      "defaultValue": "1",
      "recommendedValue": "1",
      "operator": "=",
      "description": "Safari doit avertir des sites frauduleux",
      "remediation": {
        "default": "defaults write com.apple.Safari WarnAboutFraudulentWebsites -bool true"
      }
    },
    {
      "id": "MAC8005",
      "category": "Safari Security",
      "name": "Safari Private Browsing by Default",
      "method": "defaults",
      "domain": "com.apple.Safari",
      "key": "OpenPrivateWindowWhenNotRestoringSessionAtLaunch",
      "severity": "Low",
      "recommendedValue": "1",
      "description": "Ouvrir Safari en navigation privée par défaut",
      "remediation": {
        "gui": "Safari > Réglages > Général > Safari s'ouvre avec: Une nouvelle fenêtre privée"
      }
    },
    {
      "id": "MAC9001",
      "category": "Network Security",
      "name": "Bluetooth Status",
      "method": "command",
      "command": "defaults read /Library/Preferences/com.apple.Bluetooth.plist ControllerPowerState 2>/dev/null || echo '1'",
      "severity": "Low",
      "defaultValue": "1",
      "recommendedValue": "0",
      "description": "Désactiver Bluetooth quand non utilisé réduit la surface d'attaque",
      "remediation": {
        "default": "sudo defaults write /Library/Preferences/com.apple.Bluetooth.plist ControllerPowerState -int 0",
        "gui": "Réglages Système > Bluetooth > Désactiver"
      }
    },
    {
      "id": "MAC9003",
      "category": "Network Security",
      "name": "AirDrop Mode",
      "method": "defaults",
      "domain": "com.apple.sharingd",
      "key": "DiscoverableMode",
      "severity": "Medium",
      "defaultValue": "Everyone",
      "recommendedValue": "Off",
      "description": "AirDrop doit être désactivé ou limité aux contacts",
      "remediation": {
        "default": "defaults write com.apple.sharingd DiscoverableMode -string 'Off'",
        "gui": "Finder > AirDrop > Personne"
      }
    },
    {
      "id": "MAC10001",
      "category": "User Account Security",
      "name": "Guest Account Status",
      "method": "command",
      "command": "sudo dscl . read /Users/Guest AuthenticationAuthority 2>/dev/null | grep -c 'DisabledUser' || echo 'enabled'",
      "severity": "Medium",
      "recommendedValue": "disabled",
      "description": "Le compte invité doit être désactivé",
      "remediation": {
        "default": "sudo dscl . create /Users/Guest AuthenticationAuthority ';DisabledUser;'",
        "gui": "Réglages Système > Utilisateurs et groupes > Invité > Décocher"
      }
    },
    {
      "id": "MAC10005",
      "category": "User Account Security",
      "name": "Touch ID / Face ID",
      "method": "command",
      "command": "bioutil -rs 2>/dev/null | grep -c 'enrolled' || echo '0'",
      "severity": "Info",
      "recommendedValue": "enrolled",
      "description": "Touch ID ou Face ID configuré pour une authentification plus sécurisée",
      "remediation": {
        "gui": "Réglages Système > Touch ID & Mot de passe"
      }
    },
    {
      "id": "MAC11001",
      "category": "Passwords App",
      "name": "Passwords App Security",
      "method": "info",
      "severity": "Info",
      "description": "Nouvelle app Mots de passe (Sequoia) - Gestionnaire de mots de passe intégré",
      "remediation": {
        "info": "Utiliser l'app Mots de passe pour gérer les credentials de façon sécurisée"
      }
    },
    {
      "id": "MAC12001",
      "category": "Secure Boot",
      "name": "Secure Boot Level",
      "method": "command",
      "command": "nvram 94B73556-2197-4702-82A8-3E1337DAFBFB:AppleSecureBootPolicy 2>/dev/null || echo 'not available'",
      "severity": "High",
      "recommendedValue": "02",
      "description": "Secure Boot doit être en mode Full Security",
      "remediation": {
        "manual": "Démarrer en Recovery Mode > Startup Security Utility > Full Security"
      }
    },
    {
      "id": "MAC13001",
      "category": "Window Tiling Security",
      "name": "Window Tiling Permissions",
      "method": "info",
      "severity": "Low",
      "description": "Nouveau Window Tiling (Sequoia) - Vérifier les permissions des apps tierces",
      "remediation": {
        "gui": "Réglages Système > Bureau et Dock > Fenêtres"
      }
    },
    {
      "id": "MAC14001",
      "category": "Terminal Security",
      "name": "Terminal Secure Keyboard Entry",
      "method": "defaults",
      "domain": "com.apple.Terminal",
      "key": "SecureKeyboardEntry",
      "severity": "Medium",
      "defaultValue": "0",
      "recommendedValue": "1",
      "operator": "=",
      "description": "Activer la saisie clavier sécurisée dans Terminal",
      "remediation": {
        "default": "defaults write com.apple.Terminal SecureKeyboardEntry -bool true"
      }
    },
    {
      "id": "MAC15001",
      "category": "iCloud Security",
      "name": "Advanced Data Protection",
      "method": "info",
      "severity": "High",
      "description": "Protection avancée des données iCloud - Chiffrement de bout en bout",
      "remediation": {
        "gui": "Réglages Système > Apple ID > iCloud > Protection avancée des données"
      }
    },
    {
      "id": "MAC15002",
      "category": "iCloud Security",
      "name": "Find My Mac",
      "method": "command",
      "command": "nvram -p | grep -c 'fmm-mobileme-token-FMM' || echo '0'",
      "severity": "Medium",
      "recommendedValue": "1",
      "description": "Localiser mon Mac permet de retrouver ou effacer l'appareil à distance",
      "remediation": {
        "gui": "Réglages Système > Apple ID > iCloud > Localiser mon Mac"
      }
    },
    {
      "id": "MAC16001",
      "category": "Apple Intelligence",
      "name": "Apple Intelligence Privacy",
      "method": "info",
      "severity": "Info",
      "description": "Apple Intelligence (Sequoia) traite les données localement quand possible",
      "remediation": {
        "gui": "Réglages Système > Apple Intelligence & Siri"
      }
    },
    {
      "id": "MAC16002",
      "category": "Apple Intelligence",
      "name": "Private Cloud Compute",
      "method": "info",
      "severity": "Info",
      "description": "Private Cloud Compute - Traitement cloud avec garanties de confidentialité",
      "remediation": {
        "info": "Les données sont traitées sur des serveurs Apple Silicon dédiés sans stockage"
      }
    }
  ]
}
